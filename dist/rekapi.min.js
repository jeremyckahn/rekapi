/*! Rekapi - v0.14.7 - 2013-07-21 - http://rekapi.com */
(function(){function t(t,e,n,r){n.each(t._events[e],function(e){e(t,r)})}function e(t,e){var n=[];e.each(t._actors,function(t){n.push(t.getEnd())}),t._animationLength=Math.max.apply(Math,n)}function n(){}var r=function(n,r,i){"use strict";function o(t,e){var n=Math.floor(e/t._animationLength);return n}function a(t){return g()-t._loopTimestamp}function s(t,e){return e>=t._timesToIterate&&-1!==t._timesToIterate}function c(e,n){s(e,n)&&(e.stop(),t(e,"animationComplete",r))}function u(t,e,n){var r;return r=s(t,n)?t._animationLength:e%t._animationLength}function p(t,e){var n=o(t,e),r=u(t,e,n);t.update(r),c(t,n)}function h(t){p(t,a(t))}function f(t){var e=function(){f(t),h(t)};t._loopId=t._scheduleUpdate.call?t._scheduleUpdate.call(_,e,1e3/t.config.fps):setTimeout(e,1e3/t.config.fps)}function l(t){var e;return e=60!==t?_.setTimeout:_.requestAnimationFrame||_.webkitRequestAnimationFrame||_.oRequestAnimationFrame||_.msRequestAnimationFrame||_.mozCancelRequestAnimationFrame&&_.mozRequestAnimationFrame||_.setTimeout}function d(t){var e;return e=60!==t?_.clearTimeout:_.cancelAnimationFrame||_.webkitCancelAnimationFrame||_.oCancelAnimationFrame||_.msCancelAnimationFrame||_.mozCancelRequestAnimationFrame||_.clearTimeout}function m(t){t._cancelUpdate.call?t._cancelUpdate.call(_,t._loopId):clearTimeout(t._loopId)}function y(t){return this.config=t||{},this.context=this.config.context||{},this._actors={},this._playState=T.STOPPED,this._events={animationComplete:[],playStateChange:[],play:[],pause:[],stop:[],beforeUpdate:[],afterUpdate:[],addActor:[],removeActor:[]},this._timesToIterate=-1,this._animationLength=0,this._loopId=null,this._loopTimestamp=null,this._pausedAtTime=null,this._lastUpdatedMillisecond=0,r.extend(this.config,t),r.defaults(this.config,k),this._scheduleUpdate=l(this.config.fps),this._cancelUpdate=d(this.config.fps),r.each(this._contextInitHook,function(t){t.call(this)},this),this}var v=Function,_=new v("return this")(),g=i.now,k={fps:60},T={STOPPED:"stopped",PAUSED:"paused",PLAYING:"playing"};y.prototype._contextInitHook={},y.prototype.addActor=function(n){return r.contains(this._actors,n)||(n.context()||n.context(this.context),n.kapi=this,n.fps=this.framerate(),this._actors[n.id]=n,e(this,r),n.setup(),t(this,"addActor",r,n)),this},y.prototype.getActor=function(t){return this._actors[t]},y.prototype.getActorIds=function(){return r.pluck(this._actors,"id")},y.prototype.getAllActors=function(){return r.clone(this._actors)},y.prototype.removeActor=function(n){return delete this._actors[n.id],delete n.kapi,n.teardown(),e(this,r),t(this,"removeActor",r,n),this},y.prototype.play=function(e){return m(this),this._playState===T.PAUSED?this._loopTimestamp+=g()-this._pausedAtTime:this._loopTimestamp=g(),this._timesToIterate=e||-1,this._playState=T.PLAYING,f(this),t(this,"playStateChange",r),t(this,"play",r),this},y.prototype.playFrom=function(t,e){return this.play(e),this._loopTimestamp=g()-t,this},y.prototype.playFromCurrent=function(t){return this.playFrom(this._lastUpdatedMillisecond,t)},y.prototype.pause=function(){return this._playState===T.PAUSED?this:(this._playState=T.PAUSED,m(this),this._pausedAtTime=g(),t(this,"playStateChange",r),t(this,"pause",r),this)},y.prototype.stop=function(){return this._playState=T.STOPPED,m(this),r.each(this._actors,function(t){t.stop()}),t(this,"playStateChange",r),t(this,"stop",r),this},y.prototype.isPlaying=function(){return this._playState===T.PLAYING},y.prototype.animationLength=function(){return this._animationLength},y.prototype.lastPositionUpdated=function(){return this._lastUpdatedMillisecond/this._animationLength},y.prototype.actorCount=function(){return r.size(this._actors)},y.prototype.framerate=function(t){return t&&(this.config.fps=t,this._scheduleUpdate=l(this.config.fps),this._cancelUpdate=d(this.config.fps)),this.config.fps},y.prototype.update=function(e){return void 0===e&&(e=this._lastUpdatedMillisecond),t(this,"beforeUpdate",r),r.each(this._actors,function(t){t.updateState(e),"function"==typeof t.update&&t.update(t.context(),t.get())}),this._lastUpdatedMillisecond=e,t(this,"afterUpdate",r),this},y.prototype.on=function(t,e){return this._events[t]?(this._events[t].push(e),this):void 0},y.prototype.off=function(t,e){return this._events[t]?(this._events[t]=e?r.without(this._events[t],e):[],this):void 0},y.prototype.exportTimeline=function(){var t={duration:this._animationLength,actors:{}};return r.each(this._actors,function(e){t.actors[e.id]=e.exportTimeline()},this),t},y.util={},n.Kapi=y},i=function(t,r,i){"use strict";function o(t){return t.sort(function(t,e){return t-e})}function a(t,e){var n,r=t._timelinePropertyCacheIndex,i=r.length;for(n=1;i>n;n++)if(r[n]>=e)return n-1;return-1}function s(t){r.each(t._propertyTracks,function(e,n){t._propertyTracks[n]=r.sortBy(t._propertyTracks[n],function(t){return t.millisecond})})}function c(t){r.each(t._timelinePropertyCaches,function(e,n){var i=u(t,+n);r.defaults(e,i)})}function u(t,e){var n={};return r.each(t._propertyTracks,function(t,i){var o=null;if(r.find(t,function(t){return t.millisecond>e?n[i]=o:t.millisecond===e&&(n[i]=t),o=t,!!n[i]}),!n[i]){var a=r.last(t);a&&e>=a.millisecond&&(n[i]=a)}}),n}function p(t){r.each(t._propertyTracks,function(t){r.each(t,function(e,n){e.linkToNext(t[n+1])})})}function h(t,e,n){return r.find(t._propertyTracks[e],function(t){return t.millisecond===n})}function f(t){t._timelinePropertyCaches={},r.each(t._keyframeProperties,function(e){t._timelinePropertyCaches[e.millisecond]||(t._timelinePropertyCaches[e.millisecond]={}),t._timelinePropertyCaches[e.millisecond][e.name]=e},t),t._timelinePropertyCacheIndex=r.keys(t._timelinePropertyCaches),r.each(t._timelinePropertyCacheIndex,function(e,n){t._timelinePropertyCacheIndex[n]=+e},t),o(t._timelinePropertyCacheIndex),c(t),p(t)}function l(t){s(t),f(t),e(t.kapi,r)}var d="linear",m=t.Kapi;m.Actor=function(t){return t=t||{},i.call(this),r.extend(this,{_propertyTracks:{},_timelinePropertyCaches:{},_timelinePropertyCacheIndex:[],_keyframeProperties:{},id:r.uniqueId(),setup:t.setup||n,update:t.update||n,teardown:t.teardown||n,data:{}}),t.context&&this.context(t.context),this};var y=m.Actor,v=function(){};v.prototype=i.prototype,y.prototype=new v,y.prototype.context=function(t){return t&&(this._context=t),this._context},y.prototype.keyframe=function(t,n,i){var o;return i=i||d,"string"==typeof i&&(o=i,i={},r.each(n,function(t,e){i[e]=o})),r.each(n,function(t,e){i[e]=i[e]||d}),r.each(n,function(e,n){var r=new m.KeyframeProperty(this,t,n,e,i[n]);this._keyframeProperties[r.id]=r,this._propertyTracks[n]||(this._propertyTracks[n]=[]),this._propertyTracks[n].push(r),s(this)},this),this.kapi&&e(this.kapi,r),f(this),this},y.prototype.getKeyframeProperty=function(t,e){return this._propertyTracks[t]&&this._propertyTracks[t][e]?this._propertyTracks[t][e]:void 0},y.prototype.modifyKeyframeProperty=function(t,e,n){return this._propertyTracks[t]&&this._propertyTracks[t][e]&&this._propertyTracks[t][e].modifyWith(n),l(this),this},y.prototype.getTrackNames=function(){return r.keys(this._propertyTracks)},y.prototype.getTrackLength=function(t){return this._propertyTracks[t]?this._propertyTracks[t].length:void 0},y.prototype.copyProperties=function(t,e){var n={},i={};return r.each(this._propertyTracks,function(t,r){var o=h(this,r,e);o&&(n[r]=o.value,i[r]=o.easing)},this),this.keyframe(t,n,i),this},y.prototype.wait=function(t){var e=this.getEnd();if(e>=t)return this;var n=this.getEnd(),i=u(this,this.getEnd()),o={},a={};return r.each(i,function(t,e){o[e]=t.value,a[e]=t.easing}),this.removeKeyframe(n),this.keyframe(n,o,a),this.keyframe(t,o,a),this},y.prototype.getStart=function(t){var e=[];return t?e.push(this._propertyTracks[t][0].millisecond):r.each(this._propertyTracks,function(t){t.length&&e.push(t[0].millisecond)}),0===e.length&&(e=[0]),Math.min.apply(Math,e)},y.prototype.getEnd=function(t){var e=0,n=this._propertyTracks;return t&&(n={},n[t]=this._propertyTracks[t]),r.each(n,function(t){if(t.length){var n=r.last(t).millisecond;n>e&&(e=n)}},this),e},y.prototype.getLength=function(t){return this.getEnd(t)-this.getStart(t)},y.prototype.hasKeyframeAt=function(t,e){var n=this._propertyTracks;if(e){if(!r.has(n,e))return!1;n=r.pick(n,e)}return void 0!==r.find(n,function(e,n){var r=h(this,n,t);return void 0!==r},this)},y.prototype.moveKeyframe=function(t,e){return!this.hasKeyframeAt(t)||this.hasKeyframeAt(e)?!1:(r.each(this._propertyTracks,function(n,r){var i=h(this,r,t);i&&i.modifyWith({millisecond:e})},this),l(this),!0)},y.prototype.modifyKeyframe=function(t,e,n){return n=n||{},r.each(this._propertyTracks,function(r,i){var o=h(this,i,t);o&&o.modifyWith({value:e[i],easing:n[i]})},this),this},y.prototype.removeKeyframe=function(t){return r.each(this._propertyTracks,function(e){var n=-1,i=!1;if(r.find(e,function(e){return n++,i=t===e.millisecond}),i){var o=e.splice(n,1)[0];o&&delete this._keyframeProperties[o.id]}},this),this.kapi&&e(this.kapi,r),f(this),this},y.prototype.removeAllKeyframeProperties=function(){return r.each(this._propertyTracks,function(t){t.length=0},this),this._keyframeProperties={},this.removeKeyframe(0)},y.prototype.updateState=function(t){var e=this.getStart(),n=this.getEnd();if(t=Math.min(n,t),t>=e){var i=a(this,t),o=this._timelinePropertyCaches[this._timelinePropertyCacheIndex[i]],s={};r.each(o,function(e,n){e&&(s[n]=e.getValueAt(t))}),this.set(s)}return this},y.prototype.exportTimeline=function(){var t={start:this.getStart(),end:this.getEnd(),trackNames:this.getTrackNames(),propertyTracks:{}};return r.each(this._propertyTracks,function(e,n){var i=t.propertyTracks[n]=[];r.each(e,function(t){i.push(t.exportPropertyData())})}),t}},o=function(t,e,n){"use strict";var r="linear",i=t.Kapi;i.KeyframeProperty=function(t,n,i,o,a){return this.id=e.uniqueId("keyframeProperty_"),this.ownerActor=t,this.millisecond=n,this.name=i,this.value=o,this.easing=a||r,this.nextProperty=null,this};var o=i.KeyframeProperty;o.prototype.modifyWith=function(t){var n={};e.each(["millisecond","easing","value"],function(e){n[e]=t[e]===void 0?this[e]:t[e]},this),e.extend(this,n)},o.prototype.linkToNext=function(t){this.nextProperty=t||null},o.prototype.getValueAt=function(t){var e,r={},i={};if(this.nextProperty){r[this.name]=this.value,i[this.name]=this.nextProperty.value;var o=this.nextProperty.millisecond-this.millisecond,a=(t-this.millisecond)/o;e=n.interpolate(r,i,a,this.nextProperty.easing)[this.name]}else e=this.value;return e},o.prototype.exportPropertyData=function(){return{id:this.id,millisecond:this.millisecond,name:this.name,value:this.value,easing:this.easing}}},a=function(e,n){"use strict";function r(t,e,n){return n!==void 0&&(t[e]=n,t.style[e]=n+"px"),t[e]}function i(t){t.config.clearOnUpdate&&t.canvas.clear()}function o(e){t(e,"beforeDraw",n);var r,i=e.canvas._drawOrder.length;if(e.canvas._drawOrderSorter){var o=n.sortBy(e.canvas._canvasActors,e.canvas._drawOrderSorter);r=n.pluck(o,"id")}else r=e.canvas._drawOrder;var a,s,c;for(c=0;i>c;c++)a=e.canvas._canvasActors[r[c]],s=a.context(),a.draw(s,a.get());return t(e,"afterDraw",n),e}function a(t,e){e instanceof c.CanvasActor&&(t.canvas._drawOrder.push(e.id),t.canvas._canvasActors[e.id]=e)}function s(t,e){e instanceof c.CanvasActor&&(t.canvas._drawOrder=n.without(t.canvas._drawOrder,e.id),delete t.canvas._canvasActors[e.id])}var c=e.Kapi;c.prototype._contextInitHook.canvas=function(){this.context.getContext&&(this.canvas=new u(this),this.config.clearOnUpdate=!0,n.extend(this._events,{beforeDraw:[],afterDraw:[]}),n.each(["Height","Width"],function(t){var e=t.toLowerCase();this.config[e]&&(this.canvas[e](this.config[e]),delete this.config[t])},this),this.on("afterUpdate",o),this.on("addActor",a),this.on("removeActor",s),this.on("beforeDraw",i))},c.CanvasRenderer=function(t){return this.kapi=t,this._drawOrder=[],this._drawOrderSorter=null,this._canvasActors={},this};var u=c.CanvasRenderer;u.prototype.height=function(t){return r(this.kapi.context,"height",t)},u.prototype.width=function(t){return r(this.kapi.context,"width",t)},u.prototype.clear=function(){return this.kapi.context.getContext&&this.context().clearRect(0,0,this.width(),this.height()),this.kapi},u.prototype.context=function(){return this.kapi.context.getContext("2d")},u.prototype.moveActorToLayer=function(t,e){return this._drawOrder.length>e?(this._drawOrder=n.without(this._drawOrder,t.id),this._drawOrder.splice(e,0,t.id),t):void 0},u.prototype.setOrderFunction=function(t){return this._drawOrderSorter=t,this.kapi},u.prototype.unsetOrderFunction=function(){return this._drawOrderSorter=null,this.kapi}},s=function(t){"use strict";function e(){}var r=t.Kapi;r.CanvasActor=function(t){return r.Actor.call(this,t),t=t||{},this.draw=t.draw||n,this};var i=r.CanvasActor;e.prototype=r.Actor.prototype,i.prototype=new e,i.prototype.context=function(t){return t&&(this._context=t),this._context&&this._context.getContext("2d")},i.prototype.moveToLayer=function(t){return this.kapi.canvas.moveActorToLayer(this,t)}},c=function(t,e){"use strict";function n(t,e,n){t.style[e]=n}function r(t){return e.contains(u,t)}function i(t,n){var r=[];return e.each(t,function(t){n[t]&&r.push(t+"("+n[t]+")")}),r.join(" ")}function o(t,r){e.each(c,function(e){n(t,e,r)})}function a(){}var s=t.Kapi,c=["transform","webkitTransform","MozTransform","oTransform","msTransform"],u=["translateX","translateY","scale","scaleX","scaleY","rotate","skewX","skewY"];s.DOMActor=function(t,e){s.Actor.call(this,e),this._context=t;var n=this.getCSSName();return this._context.className.match(n)||(this._context.className+=" "+n),this._transformOrder=u.slice(0),delete this.update,delete this.teardown,this};var p=s.DOMActor;a.prototype=s.Actor.prototype,p.prototype=new a,p.prototype.update=function(t,a){var s=e.keys(a),c=e.filter(s,r),u=e.reject(s,r),p=e.pick(a,u);if(c.length){var h=e.pick(a,c),f=i(this._transformOrder,h);o(t,f)}else a.transform&&o(t,a.transform);e.each(p,function(e,r){n(t,r,e)},this)},p.prototype.teardown=function(){var t=this._context.className.match(/\S+/g),n=e.without(t,this.getCSSName());this._context.className=n},p.prototype.getCSSName=function(){return"actor-"+this.id},p.prototype.setTransformOrder=function(t){var n=e.reject(t,r);if(n.length)throw"Unknown or unsupported transform functions: "+n.join(", ");return this._transformOrder=e.uniq(t),this}},u=function(t,e){"use strict";function n(t,n,i,o){var a=t.getTrackNames(),s=[];e.each(a,function(e){s.push(y(t,i,e))});var c=[];return e.each(a,function(t,e){c.push(r(s[e],n+"-"+t,o))}),c=c.join("\n")}function r(t,n,r){r=r||["w3"];var o=[];return e.each(r,function(e){var r=E(O,[C[e],n,t]),a=i(r,e);o.push(a)}),o.join("\n")}function i(t,e){var n=RegExp(w,"g"),r=C[e]+"transform",i=RegExp(P,"g"),o=C[e],a=t.replace(i,o).replace(n,r);return a}function o(t,n,r,i,o){r=r||["w3"];var s,c=[];e.each(r,function(e){s=a(t,n,e,i,o),c.push(s)});var u=E(I,[n,c.join("\n")]);return u}function a(t,e,n,r,i){var o=[],a=C[n];return o.push(s(t,e,a)),o.push(c(t,a)),o.push(u(t,a)),o.push(p(a)),o.push(h(a)),o.push(f(t.kapi,a,r)),i&&o.push(l(a)),o.join("\n")}function s(t,n,r){var i=E("  %sanimation-name:",[r]),o=t.getTrackNames();return e.each(o,function(t){i+=E(" %s-%s-keyframes,",[n,t])}),i=i.slice(0,i.length-1),i+=";"}function c(t,e){return E("  %sanimation-duration: %sms;",[e,t.getEnd()-t.getStart()])}function u(t,e){return E("  %sanimation-delay: %sms;",[e,t.getStart()])}function p(t){return E("  %sanimation-fill-mode: forwards;",[t])}function h(t){return E("  %sanimation-timing-function: linear;",[t])}function f(t,e,n){var r;r=n?n:-1===t._timesToIterate?"infinite":t._timesToIterate;var i="  %sanimation-iteration-count: %s;";return E(i,[e,r])}function l(t){return E("  %stransform-origin: 0 0;",[t])}function d(t){var e=!1;if(t.nextProperty){var n,r=t.nextProperty.easing.split(" "),i=0,o=r.length,a=r[0];for(i;o>i;i++){if(n=r[i],!S[n]||a!==n){e=!1;break}e=!0,a=n}}return e}function m(t,e,n){var r=[],i=t.name;"transform"===t.name&&(i=w);var o=S[t.nextProperty.easing.split(" ")[0]],a=E("cubic-bezier(%s)",[o]);return r.push(E("  %s% {%s:%s;%sanimation-timing-function: %s;}",[e,i,t.value,P,a])),r.push(E("  %s% {%s:%s;}",[n,i,t.nextProperty.value])),r.join("\n")}function y(t,n,r){var i=[],o=t.getEnd(),a=t.getStart(),s=t.getLength(),c=v(t,r,a);c&&i.push(c);var u=!1;e.each(t._propertyTracks[r],function(e){var r,o,c,p=g(e,a,s),h=e.nextProperty;if(h){r=g(h,a,s);var f=r-p;o=Math.floor(f/100*n)||1,c=f/o}else r=100,o=1,c=1;var l;if(d(e)){if(l=m(e,p,r),u){var y=i.length,v=i[y-1],_=v.split("\n")[0];i[y-1]=_}u=!0}else l=k(t,e,o,c,a,p),u&&l.shift(),l.length&&(l=l.join("\n")),u=!1;l.length&&i.push(l)});var p=_(t,r,a,o);return p&&i.push(p),i.join("\n")}function v(t,e,n){var r=t._propertyTracks[e][0];if(r.millisecond!==n){var i=k(t,r,1,1,r.millisecond,0);return i.join("\n")}}function _(t,n,r,i){var o=e.last(t._propertyTracks[n]);if(o.millisecond!==i){var a=k(t,o,1,1,r,100);return a.join("\n")}}function g(t,e,n){return 100*((t.millisecond-e)/n)}function k(t,e,n,r,i,o){var a,s,c,u=[],p=t.getLength();for(a=0;n>a;a++)s=o+a*r,t.updateState(s/100*p+i),c=+s.toFixed(2)+"% ",u.push("  "+c+T(t,e.name));return u}function T(t,n){var r,i=["{"];if(n){r={};var o=t.get()[n];o!==void 0&&(r[n]=o)}else r=t.get();var a;return e.each(r,function(t,e){a=t;var n=e;"transform"===e&&(n=w),i.push(n+":"+a+";")}),i.push("}"),i.join("")}var x=t.Kapi,A=100,w="TRANSFORM",P="VENDOR",C=x.util.VENDOR_PREFIXES={microsoft:"-ms-",mozilla:"-moz-",opera:"-o-",w3:"",webkit:"-webkit-"},S={linear:".25,.25,.75,.75",easeInQuad:".55,.085,.68,.53",easeInCubic:".55,.055,.675,.19",easeInQuart:".895,.03,.685,.22",easeInQuint:".755,.05,.855,.06",easeInSine:".47,0,.745,.715",easeInExpo:".95,.05,.795,.035",easeInCirc:".6,.04,.98, .335",easeInBack:".6,-.28,.735,.045",easeOutQuad:".25,.46,.45,.94",easeOutCubic:".215,.61,.355,1",easeOutQuart:".165,.84,.44,1",easeOutQuint:".23,1,.32,1",easeOutSine:".39,.575,.565,1",easeOutExpo:".19,1,.22,1",easeOutCirc:".075,.82,.165,1",easeOutBack:".175,.885,.32,1.275",easeInOutQuad:".455,.03,.515,.955",easeInOutCubic:".645,.045,.355,1",easeInOutQuart:".77,0,.175,1",easeInOutQuint:".86,0.07,1",easeInOutSine:".445,.05,.55,.95",easeInOutExpo:"1,0,0,1",easeInOutCirc:".785,.135,.15,.86",easeInOutBack:".68,-.55,.265,1.55"},O=["@%skeyframes %s-keyframes {","%s","}"].join("\n"),I=[".%s {","%s","}"].join("\n");x.prototype.toCSS=function(t){t=t||{};var n=[];return e.each(this.getAllActors(),function(e){e instanceof x.DOMActor&&n.push(e.toCSS(t))}),n.join("\n")},x.Actor.prototype.toCSS=function(t){t=t||{};var e=[],r=t.name||this.getCSSName();this._context.className.match(r)||(this._context.className+=" "+r);var i=t.granularity||A,a=o(this,r,t.vendors,t.iterations,t.isCentered),s=n(this,r,i,t.vendors);return e.push(a),e.push(s),e.join("\n")};var E=x.util.printf=function(t,n){var r=t;return e.each(n,function(t){r=r.replace("%s",t)}),r}},p=function(t,e){"use strict";var n=e?{}:t,p=e&&e.underscore?e.underscore:n._,h=e&&e.Tweenable?e.Tweenable:n.Tweenable;return r(n,p,h),i(n,p,h),o(n,p,h),"function"==typeof c&&c(n,p,h),"function"==typeof u&&u(n,p,h),"function"==typeof a&&a(n,p,h),"function"==typeof s&&s(n,p,h),n.Kapi};if("function"==typeof define&&define.amd){var h="undefined"!=typeof _;define(["shifty","underscore"],function(t,e){var n=null!=e,r={Tweenable:t,underscore:n?e:_},i=p({},r);return!h&&n&&(this._=void 0),i})}else p(this)})(this);